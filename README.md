[![Compile Mermaid](https://github.com/bet-no-loss/bet-no-loss/actions/workflows/compile_mermaid.yml/badge.svg?branch=master&event=push)](https://github.com/bet-no-loss/bet-no-loss/actions/workflows/compile_mermaid.yml)
![Heroku](https://heroku-badge.herokuapp.com/?app=bet-no-loss&style=flat&svg=1)
[![built-with openzeppelin](https://img.shields.io/badge/built%20with-OpenZeppelin-3677FF)](https://docs.openzeppelin.com/)
 
# Bet-no-loss

> Tagline: Bet on a sport event without loosing your stake and get rewarded if you win.
 
## Description

- Players bet on a sport event during week 1.  
- The total amount of bets (all players included) is then staked in DeFi during week 2.  
- Finally at the end of week 3, 90% of accrued interests can be split between winners according to their share in the total deposit value. 
Each winner can then withdraw the 90% accrued interests in DeFi proportionally to his/her initial stake.


## Links

* [Presentation](https://docs.google.com/presentation/d/1HCxnNpTpJYLMGsOCu0hRTsVv7Z5x4cg-bcDrq56NjBc)
* [Wireframes](https://app.diagrams.net/#G1tXstsevdC_w0BXNJh9pAyF5CtaAM2az-)
* [Github](https://github.com/bet-no-loss/bet-no-loss/) (Source coded, issues, wiki)
* [DaPP Heroku](https://bet-no-loss.herokuapp.com/)
* [Trello](https://trello.com/b/c6Xhe5hM)
* [Google Drive](https://drive.google.com/drive/folders/1Pr22-VTGNVREl7AUdPy1f77OxrgqNvgO)
* [YouTube Playlist](https://www.youtube.com/playlist?list=PLNwicjhsnUEooeRnNgrkV0TH6m21F3jpA) 

## Features

TODO


# Install

Installing locally consists in a 2 steps process:
- Clone the repository:
- Install the `npm` packages for the back-end and the front-end

```
cd $DEV

# ~~~ Clone the repository
git clone git@github.com:bet-no-loss/bet-no-loss.git
cd bet-no-loss

# ~~~ Install the npm packages for the back-end
npm install

# ~~~ Install the npm packages for the front-end
npm --prefix client/ install
```

# Configure

In order to use the project locally as a dev you need to create a **`.env`** file in the project' root.
It contains the environment specific parameters for the test and main networks.

- Create a `.env` file in the project's root folder  
- Edit `.env` and set the below `property = "value"` pairs (one per line):
```
MNEMONIC          = "TODO_enter_your_own_12_words_seed_here"
INFURA_PROJECT_ID = "TODO_infura_project_id_here"
```

ℹ️ Keep in mind to surround each value with double quotes.

# Compile

```
npx truffle compile # --all
```

# Test

Run ganache on port 7545.

```
npx truffle test # Run the unit and integration tests

npx truffle deploy --reset --network ganache
```

# Deploy 

## Deploy the Smart-Contracts

```
npx truffle deploy
```

## Deploy the DApp

We deploy the Front-End application on **[Heroku](https://heroku.com)**.  
Each time a push is made on the `master` branch of the `bet-no-loss` Github repository this notifies Heroku which pulls this branch and deploys it there. 
This is what Heroku calls a [github-integration](https://devcenter.heroku.com/articles/github-integration).


# Run the DApp

In order to run the Front-End application, simply:
```
cd client 
npm start
```

# Documentation

Each smart-contract is documented in a Markdown file in `client/src/contracts`.

Should you need to update the documentation, simply run:
```
npx leafleth -s contracts
```

## Decisions

- Crypto-currency used: DAI
- DeFi Service used: For now none, due to time constraints we will stub them. Later on: Compound or AAVE ?
- No Back-Office for now.  
  As we focus only on having a running project with smart contract + front-office.
  This means in order to add events the owner calls the ad-hoc smart-contract's functions.

## Interactions Diagram

<!-- generated by mermaid compile action - START -->
![~mermaid diagram 1~](/doc/img/README-md-1.svg)
<details>
  <summary>Mermaid markup</summary>

```mermaid
sequenceDiagram autonumber
    Admin->>Oracle: Create Contract
    Admin->>Oracle: Declare Event
    Admin->>DeFi: Create Contract
    Admin->>Bet: Create Contract
    
    Bet->>Oracle:  Get Events List
    Player->>DApp: Browse Events
    Player->>DApp: Select an Event
    Player->>DApp: Connect Wallet
    
    Player->>DApp: Deposit Funds
    activate DApp
    DApp->>Bet: Deposit Funds
    deactivate DApp
    
    Note left of Bet: ⏰ Close Betting period
    Bet->>DeFi: Send deposits to DeFi Earn
    activate DeFi
    DeFi-->>DeFi: Accruing    Interests    

    Admin-->>Oracle: Simulate Event Outcome
    Note left of Oracle: ⏰ Event is over and its outcome is known
    Oracle->>Bet: Report    Event Outcome 
    
    Note left of Bet: ⏰ Earning period is over
    deactivate DeFi
    Bet->>DeFi: Retrieve Interests
    DeFi->>Bet: Accept Retrieval

    Player->>Bet: Request Earnings
    Bet->>Player: Accept Retrieval if allowed
    
    Bet->>Bet: Close this event 
```

</details>
<!-- generated by mermaid compile action - END -->

